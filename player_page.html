<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Player Page</title>
  <style>
    body, body * {
      font-weight: bold !important;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    :root {
      --dark-bg: #121212;
      --darker-bg: #0a0a0a;
      --card-bg: #1e1e1e;
      --text-primary: #ffffff;
      --text-secondary: #b0b0b0;
      --accent-gold: #FFD700;
      --accent-blue: #1d428a;
    }

    body {
      background-color: var(--dark-bg);
      color: var(--text-primary);
      font-family: Arial, sans-serif;
    }

    .navbar {
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%;
      background-color: var(--darker-bg); 
      padding: 15px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5); 
      z-index: 1000;
      border-bottom: 2px solid var(--accent-gold);
    }
    .navbar-container {
      max-width: 1200px; 
      margin: 0 auto;
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      padding: 0 20px;
    }
    .navbar-logo { 
      color: var(--accent-gold); 
      font-size: 24px; 
      text-decoration: none; 
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .navbar-menu { 
      display: flex; 
      list-style: none; 
    }
    .navbar-item { 
      margin-left: 20px; 
    }
    .navbar-link {
      color: var(--text-primary); 
      text-decoration: none; 
      font-size: 16px;
      padding: 8px 12px; 
      border-radius: 4px; 
      transition: all 0.3s;
      border: 1px solid transparent;
    }
    .navbar-link:hover { 
      color: var(--accent-gold);
      border-color: var(--accent-gold);
    }
    .navbar-link.active { 
      background-color: rgba(255, 215, 0, 0.2);
      color: var(--accent-gold);
      border-color: var(--accent-gold);
    }

    #playerHeader {
      padding: 10px 0 0 10px;
      width: 100%;
      margin-top: 62px;
    }

    .player-header-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .player-info {
      display: flex;
      flex-direction: column;
    }

    #teamLogo {
      width: 160px;
      height: 160px;
      object-fit: contain;
      border-radius: 8px;
    }

    #playerName {
      margin: 0 0 5px 0;
      font-size: 2.2rem;
    }

    #playerTeam {
      color: var(--text-secondary);
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    .physical-attributes {
      display: flex;
      gap: 15px;
      font-size: 1.1rem;
      color: var(--text-primary);
    }

    .player-details-container {
      padding: 20px 10px;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Master Player Block Styles */
    .master-player-container {
      background-color: var(--card-bg);
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      border-left: 4px solid var(--accent-gold);
    }

    .master-player-header {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--darker-bg);
    }

    .master-player-tabs {
      display: flex;
      gap: 10px;
    }

    .master-player-tab {
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 4px;
      background-color: var(--darker-bg);
      transition: all 0.3s;
    }

    .master-player-tab:hover {
      background-color: rgba(255, 215, 0, 0.1);
    }

    .master-player-tab.active {
      background-color: rgba(255, 215, 0, 0.2);
      color: var(--accent-gold);
    }

    .master-player-content {
      display: none;
      padding: 15px;
    }

    .master-player-content.active {
      display: block;
    }

    .attributes-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    .attribute-category {
      margin-bottom: 20px;
    }

    .attribute-category h4 {
      color: var(--accent-gold);
      margin-bottom: 10px;
      border-bottom: 1px solid var(--darker-bg);
      padding-bottom: 5px;
    }

    .attribute-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
    }

    .attribute-label {
      color: var(--text-secondary);
    }

    .attribute-value {
      color: var(--text-primary);
    }

    .badges-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }

    .badge-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background-color: var(--darker-bg);
      border-radius: 4px;
    }
    .badge-item .attribute-label {
      color: white !important;
      font-weight: bold !important;
    }


    .badge-icon {
      width: 30px;
      height: 30px;
      background-color: var(--accent-gold);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .badges-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      width: 100%;
      max-width: 1200px; 
    }

    .tendencies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }

    .hotzones-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .hotzones-court {
      width: 300px;
      height: 280px;
      background-color: var(--darker-bg);
      position: relative;
      margin: 20px 0;
      border-radius: 4px;
    }

    .animations-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }

    .animation-item {
      padding: 10px;
      background-color: var(--darker-bg);
      border-radius: 4px;
    }

    .stats-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .stats-table th {
      background-color: var(--darker-bg);
      color: var(--accent-gold);
      padding: 12px;
      text-align: left;
      border-bottom: 2px solid var(--accent-gold);
    }

    .stats-table td {
      padding: 12px;
      border-bottom: 1px solid var(--darker-bg);
    }

    .stats-table tr:last-child td {
      border-bottom: none;
    }

    @media (max-width: 1024px) {
      .attributes-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      #playerHeader {
        padding: 8px 0 0 8px;
      }
      
      .player-header-container {
        gap: 10px;
      }
      
      #teamLogo {
        width: 120px;
        height: 120px;
      }
      
      #playerName {
        font-size: 1.8rem;
      }

      .physical-attributes {
        font-size: 1rem;
        gap: 10px;
      }

      .master-player-tabs {
        flex-wrap: wrap;
        justify-content: center;
      }

      .attributes-grid {
        grid-template-columns: 1fr;
      }

      .badges-container {
        grid-template-columns: 1fr 1fr;
      }

      .stats-table th, 
      .stats-table td {
        padding: 8px;
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      .navbar {
        padding: 12px 0;
      }
      
      .navbar-container {
        padding: 0 10px;
      }
      
      .navbar-logo {
        font-size: 20px;
      }
      
      .navbar-link {
        font-size: 14px;
        padding: 6px 8px;
      }
      
      #playerHeader {
        margin-top: 58px;
        padding: 5px 0 0 5px;
      }
      
      #teamLogo {
        width: 100px;
        height: 100px;
      }
      
      #playerName {
        font-size: 1.5rem;
      }
      
      #playerTeam {
        font-size: 0.9rem;
      }

      .physical-attributes {
        flex-wrap: wrap;
        gap: 8px;
        font-size: 0.9rem;
      }

      .master-player-tab {
        padding: 8px 12px;
        font-size: 14px;
      }

      .badges-container {
        grid-template-columns: 1fr;
      }

      .hotzones-court {
        width: 250px;
        height: 230px;
      }

      .stats-table {
        display: block;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-container">
      <a href="index.html" class="navbar-logo">LBA</a>
      <ul class="navbar-menu">
        <li class="navbar-item"><a href="index.html" class="navbar-link">Home</a></li>
        <li class="navbar-item"><a href="#" class="navbar-link">Schedule</a></li>
        <li class="navbar-item"><a href="#" class="navbar-link active">Players</a></li>
        <li class="navbar-item"><a href="#" class="navbar-link">Stats</a></li>
        <li class="navbar-item"><a href="teams.html" class="navbar-link">Teams</a></li>
      </ul>
    </div>
  </nav>

  <div id="playerHeader">
    <div class="player-header-container">
      <img id="teamLogo" src="" alt="Team Logo" />
      <div class="player-info">
        <h1 id="playerName">Loading...</h1>
        <p id="playerTeam"></p>
        <div class="physical-attributes">
          <span>Height: <span id="playerHeight">-</span></span>
          <span>Weight: <span id="playerWeight">-</span></span>
          <span>Wingspan: <span id="playerWingspan">-</span></span>
        </div>
      </div>
    </div>
  </div>

  <div class="player-details-container">
    <!-- Master Player Block -->
    <div class="master-player-container">
      <div class="master-player-header">
        <div class="master-player-tabs">
          <div class="master-player-tab active" data-tab="attributes">Attributes</div>
          <div class="master-player-tab" data-tab="badges">Badges</div>
          <div class="master-player-tab" data-tab="tendencies">Tendencies</div>
          <div class="master-player-tab" data-tab="hotzones">Hotzones</div>
          <div class="master-player-tab" data-tab="animations">Animations</div>
        </div>
      </div>
      
      <!-- Attributes Content -->
      <div id="attributes-content" class="master-player-content active">
        <div class="attributes-grid">
          <!-- First Row -->
          <div class="attribute-category">
            <h4>Finishing:</h4>
            <div class="attribute-row">
              <span class="attribute-label">Driving Layup:</span>
              <span id="driving-layup" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Standing Dunk:</span>
              <span id="standing-dunk" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Driving Dunk:</span>
              <span id="driving-dunk" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Close Shot:</span>
              <span id="close-shot" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Post Hook:</span>
              <span id="post-hook" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Post Moves:</span>
              <span id="post-moves" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Post Fade:</span>
              <span id="post-fade" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Draw Foul:</span>
              <span id="draw-foul" class="attribute-value">-</span>
            </div>
          </div>
          
          <div class="attribute-category">
            <h4>Shooting:</h4>
            <div class="attribute-row">
              <span class="attribute-label">Mid-Range Shot:</span>
              <span id="mid-range" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Three-Point Shot:</span>
              <span id="three-pt" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Free Throw:</span>
              <span id="free-throw" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Shot IQ:</span>
              <span id="shot-iq" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Hands:</span>
              <span id="hands" class="attribute-value">-</span>
            </div>
          </div>
          
          <div class="attribute-category">
            <h4>Playmaking:</h4>
            <div class="attribute-row">
              <span class="attribute-label">Ball Control:</span>
              <span id="ball-control" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Pass IQ:</span>
              <span id="pass-iq" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Pass Accuracy:</span>
              <span id="pass-accuracy" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Pass Vision:</span>
              <span id="pass-vision" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Speed With Ball:</span>
              <span id="speed-with-ball" class="attribute-value">-</span>
            </div>
          </div>
          
          <!-- Second Row -->
          <div class="attribute-category">
            <h4>Defense:</h4>
            <div class="attribute-row">
              <span class="attribute-label">Interior Defense:</span>
              <span id="interior-defense" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Perimeter Defense:</span>
              <span id="perimeter-defense" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Block:</span>
              <span id="block" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Steal:</span>
              <span id="steal" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Help Defense IQ:</span>
              <span id="help-defense-iq" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Pass Perception:</span>
              <span id="pass-perception" class="attribute-value">-</span>
            </div>
          </div>
          
          <div class="attribute-category">
            <h4>Athleticism:</h4>
            <div class="attribute-row">
              <span class="attribute-label">Speed:</span>
              <span id="speed" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Agility:</span>
              <span id="agility" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Strength:</span>
              <span id="strength" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Vertical:</span>
              <span id="vertical" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Hustle:</span>
              <span id="hustle" class="attribute-value">-</span>
            </div>
          </div>
          
          <div class="attribute-category">
            <h4>Other:</h4>
            <div class="attribute-row">
              <span class="attribute-label">Offensive Rebound:</span>
              <span id="off-rebound" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Defensive Rebound:</span>
              <span id="def-rebound" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Offensive Consistency:</span>
              <span id="off-consistency" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Defensive Consistency:</span>
              <span id="def-consistency" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Intangibles:</span>
              <span id="intangibles" class="attribute-value">-</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Badges Content -->
      <div id="badges-content" class="master-player-content">
        <div class="badges-container">
          <!-- First Row -->
          <div class="attribute-category">
            <h4>Finishing:</h4>
            <div class="badge-item">
              <span class="attribute-label">Aerial Wizard</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Float Game</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Hook Specialist</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Layup Mixmaster</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Paint Prodigy</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Physical Finisher</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Post Fade Phenom</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Post Powerhouse</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Post Up Poet</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Posterizer</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Rise Up</span>
            </div>
          </div>

          <div class="attribute-category">
            <h4>Shooting:</h4>
            <div class="badge-item">
              <span class="attribute-label">Deadeye</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Limitless Range</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Mini Marksman</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Set Shot Specialist</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Shifty Shooter</span>
            </div>
          </div>

          <div class="attribute-category">
            <h4>Playmaking:</h4>
            <div class="badge-item">
              <span class="attribute-label">Ankle Assassin</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Bail Out</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Break Starter</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Dimer</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Lightning Launch</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Strong Handle</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Unpluckable</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Versatile Visionary</span>
            </div>
          </div>
        </div>

        <!-- Second Row (Centered) -->
        <div class="badges-container" style="justify-content: center; margin-top: 20px;">
          <div class="attribute-category">
            <h4>Defense:</h4>
            <div class="badge-item">
              <span class="attribute-label">Challenger</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Glove</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Interceptor</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">High Flying Denier</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Immovable Enforcer</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Off Ball Pest</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">On-Ball Menace</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Paint Patroller</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Pick Dodger</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Post Lockdown</span>
            </div>
          </div>

          <div class="attribute-category">
            <h4>Other:</h4>
            <div class="badge-item">
              <span class="attribute-label">Boxout Beast</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Rebound Chaser</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Brick Wall</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Slippery Off Ball</span>
            </div>
            <div class="badge-item">
              <span class="attribute-label">Pogo Stick</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tendencies Content -->
      <div id="tendencies-content" class="master-player-content">
        <div class="tendencies-grid">
          <div class="attribute-category">
            <h4>Offensive Tendencies</h4>
            <div class="attribute-row">
              <span class="attribute-label">Shoot Inside:</span>
              <span id="tendency-inside" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Shoot Mid-Range:</span>
              <span id="tendency-mid" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Shoot 3PT:</span>
              <span id="tendency-three" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Drive to Basket:</span>
              <span id="tendency-drive" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Post Up:</span>
              <span id="tendency-post" class="attribute-value">-</span>
            </div>
          </div>
          
          <div class="attribute-category">
            <h4>Defensive Tendencies</h4>
            <div class="attribute-row">
              <span class="attribute-label">On-Ball Defense:</span>
              <span id="tendency-onball" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Steal Attempts:</span>
              <span id="tendency-steal" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Block Attempts:</span>
              <span id="tendency-block" class="attribute-value">-</span>
            </div>
            <div class="attribute-row">
              <span class="attribute-label">Help Defense:</span>
              <span id="tendency-help" class="attribute-value">-</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Hotzones Content -->
      <div id="hotzones-content" class="master-player-content">
        <div class="hotzones-container">
          <p>Player shooting percentages by area on the court</p>
          <div class="hotzones-court">
            <!-- This would be replaced with an actual court visualization -->
            <p style="text-align: center; margin-top: 120px;">Hotzones visualization would appear here</p>
          </div>
          <div class="attribute-row">
            <span class="attribute-label">Overall Shooting %:</span>
            <span id="overall-shooting" class="attribute-value">-</span>
          </div>
          <div class="attribute-row">
            <span class="attribute-label">3PT Shooting %:</span>
            <span id="threept-shooting" class="attribute-value">-</span>
          </div>
        </div>
      </div>
      
      <!-- Animations Content -->
      <div id="animations-content" class="master-player-content">
        <div class="animations-list">
          <!-- Animations will be populated by JavaScript -->
        </div>
      </div>
    </div>
    
    <h2 style="color: var(--accent-gold); margin-top: 30px;">Season Stats:</h2>
    <table class="stats-table">
      <thead>
        <tr>
          <th>Season</th>
          <th>PPG</th>
          <th>RPG</th>
          <th>APG</th>
          <th>SPG</th>
          <th>BPG</th>
          <th>FG%</th>
          <th>3P%</th>
          <th>FT%</th>
        </tr>
      </thead>
      <tbody id="statsBody">
        <tr>
          <td colspan="9" style="text-align: center;">No stats available</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script>
    // Function to get URL parameters
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        player: params.get('player'),
        height: params.get('height'),
        weight: params.get('weight'),
        wingspan: params.get('wingspan'),
        team: params.get('team'),
        teamLogo: params.get('teamLogo'),
        teamColor: params.get('teamColor'),
        teamOwner: params.get('teamOwner'),
        dataRow: params.get('dataRow')
      };
    }

    // Function to find player by name in CSV data
    function findPlayerByName(csvData, playerName) {
      console.log("Searching for player:", playerName);

      // Check if we have a header row by looking at the first row
      const hasHeader = csvData.length > 0 && (
        typeof csvData[0][0] === 'string' && 
        csvData[0][0].toLowerCase().includes('name')
      );

      const startRow = hasHeader ? 1 : 0;
      console.log("Has header row:", hasHeader, "Starting search from row:", startRow);

      for (let i = startRow; i < csvData.length; i++) {
        const row = csvData[i];
        if (row && row.length > 0) {
          const csvPlayerName = row[0];
          if (csvPlayerName && csvPlayerName.toString().toLowerCase().trim() === playerName.toLowerCase().trim()) {
            console.log("Found player at row:", i, "Player name:", csvPlayerName);
            return i;
          }
        }
      }

      console.log("Player not found in CSV data");
      return -1;
    }

    // Helper function to darken colors for borders
    function darkenColor(color, percent) {
      const num = parseInt(color.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) - amt;
      const G = (num >> 8 & 0x00FF) - amt;
      const B = (num & 0x0000FF) - amt;
      return `#${(
        0x1000000 +
        (R < 0 ? 0 : R) * 0x10000 +
        (G < 0 ? 0 : G) * 0x100 +
        (B < 0 ? 0 : B)
      ).toString(16).slice(1)}`;
    }

    // Function to fetch player attributes from CSV
    function fetchPlayerAttributes(dataRow, playerName = null) {
      console.log("fetchPlayerAttributes called with dataRow:", dataRow, "playerName:", playerName);
      const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQJJKiG4UE5nmSlrtKQ79eKhNaxqnWEUpwKMlOrmiCgRSBe9uFsJ1ywQGCkaNnt5BwfwySEcWzuEZpq/pub?gid=408327260&single=true&output=csv';

      Papa.parse(csvUrl, {
        download: true,
        header: false,
        complete: function(results) {
          console.log("CSV data loaded, total rows:", results.data.length);

          let targetRow = dataRow;

          if (targetRow === null && playerName) {
            targetRow = findPlayerByName(results.data, playerName);
          }

          console.log("Target row:", targetRow);

          if (targetRow >= 0 && results.data.length > targetRow) {
            const rowData = results.data[targetRow];
            console.log("Raw row data:", rowData);

            const attributes = {
              'driving-layup': rowData[5],
              'post-fade': rowData[6],
              'post-hook': rowData[7],
              'post-moves': rowData[8],
              'draw-foul': rowData[9],
              'close-shot': rowData[10],
              'mid-range': rowData[11],
              'three-pt': rowData[12],
              'free-throw': rowData[13],
              'ball-control': rowData[14],
              'pass-iq': rowData[15],
              'pass-accuracy': rowData[16],
              'off-rebound': rowData[17],
              'standing-dunk': rowData[18],
              'driving-dunk': rowData[19],
              'shot-iq': rowData[20],
              'pass-vision': rowData[21],
              'hands': rowData[22],
              'def-rebound': rowData[23],
              'interior-defense': rowData[24],
              'perimeter-defense': rowData[25],
              'block': rowData[26],
              'steal': rowData[27],
              'speed': rowData[28],
              'speed-with-ball': rowData[29],
              'vertical': rowData[30],
              'strength': rowData[31],
              'hustle': rowData[32],
              'agility': rowData[33],
              'pass-perception': rowData[34],
              'def-consistency': rowData[35],
              'help-defense-iq': rowData[36],
              'off-consistency': rowData[37],
              'intangibles': rowData[38]
            };

            Object.keys(attributes).forEach(id => {
              const element = document.getElementById(id);
              if (element) {
                const value = attributes[id];
                element.textContent = (value !== undefined && value !== null && value !== '') ? value : '-';
              }
            });

          } else {
            console.error("Row not found. Requested row:", targetRow, "Total rows:", results.data.length);
            showNoDataMessage();
          }
        },
        error: function(error) {
          console.error('Error loading player attributes:', error);
          showNoDataMessage();
        }
      });
    }

    // Function to fetch and color badges based on their values
    function fetchAndColorBadges(dataRow, playerName = null) {
      console.log("fetchAndColorBadges called with dataRow:", dataRow, "playerName:", playerName);
      const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQJJKiG4UE5nmSlrtKQ79eKhNaxqnWEUpwKMlOrmiCgRSBe9uFsJ1ywQGCkaNnt5BwfwySEcWzuEZpq/pub?gid=408327260&single=true&output=csv';

      Papa.parse(csvUrl, {
        download: true,
        header: false,
        complete: function(results) {
          console.log("CSV data loaded for badges, total rows:", results.data.length);

          let targetRow = dataRow;

          if (targetRow === null && playerName) {
            targetRow = findPlayerByName(results.data, playerName);
          }

          console.log("Target row for badges:", targetRow);

          if (targetRow >= 0 && results.data.length > targetRow) {
            const rowData = results.data[targetRow];
            console.log("Raw row data for badges:", rowData);

            const badgeColumns = {
              'Aerial Wizard': rowData[56],
              'Float Game': rowData[65],
              'Hook Specialist': rowData[69],
              'Layup Mixmaster': rowData[72],
              'Paint Prodigy': rowData[78],
              'Physical Finisher': rowData[80],
              'Post Fade Phenom': rowData[84],
              'Post Powerhouse': rowData[86],
              'Post Up Poet': rowData[87],
              'Posterizer': rowData[83],
              'Rise Up': rowData[89],
              'Deadeye': rowData[63],
              'Limitless Range': rowData[74],
              'Mini Marksman': rowData[75],
              'Set Shot Specialist': rowData[90],
              'Shifty Shooter': rowData[91],
              'Ankle Assassin': rowData[57],
              'Bail Out': rowData[58],
              'Break Starter': rowData[60],
              'Dimer': rowData[64],
              'Lightning Launch': rowData[73],
              'Strong Handle': rowData[92],
              'Unpluckable': rowData[93],
              'Versatile Visionary': rowData[94],
              'Challenger': rowData[62],
              'Glove': rowData[66],
              'Interceptor': rowData[71],
              'High Flying Denier': rowData[68],
              'Immovable Enforcer': rowData[70],
              'Off Ball Pest': rowData[76],
              'On-Ball Menace': rowData[77],
              'Paint Patroller': rowData[79],
              'Pick Dodger': rowData[81],
              'Post Lockdown': rowData[85],
              'Boxout Beast': rowData[59],
              'Rebound Chaser': rowData[88],
              'Brick Wall': rowData[61],
              'Slippery Off Ball': rowData[91],
              'Pogo Stick': rowData[82]
            };

            const badgeColors = {
              'Bronze': '#996633',
              'Silver': '#a5a5a5',
              'Gold': '#ffc000',
              'Hall of Fame': '#7030a0',
              'Legend': '#7030a0'
            };

            // Apply colors to entire badge blocks
            Object.keys(badgeColumns).forEach(badgeName => {
              const badgeValue = badgeColumns[badgeName];
              if (badgeValue && badgeValue !== 'Null' && badgeValue.trim() !== '') {
                const color = badgeColors[badgeValue.trim()];
                if (color) {
                  const badgeElements = document.querySelectorAll(`.badge-item`);
                  badgeElements.forEach(element => {
                    if (element.querySelector('.attribute-label').textContent === badgeName) {
                      element.style.backgroundColor = color;
                      element.querySelector('.attribute-label').style.color = 'white';
                    }
                  });
                }
              }
            });

          } else {
            console.error("Row not found for badges. Requested row:", targetRow, "Total rows:", results.data.length);
          }
        },
        error: function(error) {
          console.error('Error loading player badges:', error);
        }
      });
    }

    function showNoDataMessage() {
      const attributeElements = document.querySelectorAll('.attribute-value');
      attributeElements.forEach(element => {
        if (element.textContent === '-') {
          element.textContent = 'N/A';
          element.style.color = '#666';
        }
      });
    }

    function populatePlayerData() {
      const params = getUrlParams();

      if (params.player) {
        const playerName = decodeURIComponent(params.player);
        document.getElementById('playerName').textContent = playerName;
        document.title = playerName + " | LBA";
      }

      if (params.height) {
        document.getElementById('playerHeight').textContent = decodeURIComponent(params.height);
      }
      if (params.weight) {
        document.getElementById('playerWeight').textContent = decodeURIComponent(params.weight);
      }
      if (params.wingspan) {
        document.getElementById('playerWingspan').textContent = decodeURIComponent(params.wingspan);
      }

      if (params.team) {
        const teamName = decodeURIComponent(params.team);
        document.getElementById('playerTeam').textContent = teamName;
      }

      if (params.teamLogo) {
        const logoUrl = decodeURIComponent(params.teamLogo);
        const img = document.getElementById('teamLogo');
        img.src = logoUrl;
        img.onerror = function() {
          console.error("Failed to load team logo:", logoUrl);
          this.src = "https://via.placeholder.com/160?text=No+Logo";
        };
      }

      if (params.teamColor) {
        const color = decodeURIComponent(params.teamColor);
        const elements = ['playerName', 'playerTeam', 'playerHeight', 'playerWeight', 'playerWingspan'];
        elements.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.style.color = color;
          }
        });
      }

      const dataRow = params.dataRow ? parseInt(params.dataRow) : null;
      const playerName = params.player ? decodeURIComponent(params.player) : null;

      if (dataRow !== null || playerName) {
        console.log("Fetching player data - dataRow:", dataRow, "playerName:", playerName);
        fetchPlayerAttributes(dataRow, playerName);
        fetchAndColorBadges(dataRow, playerName);
      } 
    }

    function setupTabs() {
      const tabs = document.querySelectorAll('.master-player-tab');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.master-player-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.master-player-content').forEach(c => c.classList.remove('active'));

          tab.classList.add('active');
          const tabName = tab.getAttribute('data-tab');
          const content = document.getElementById(`${tabName}-content`);
          if (content) {
            content.classList.add('active');
          }
        });
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM fully loaded");

      const params = getUrlParams();
      console.log("URL Parameters:", params);

      populatePlayerData();
      setupTabs();

      if (!params.player) {
        console.warn("No player data in URL, using fallback");
        document.getElementById('playerName').textContent = "Player Not Found";
        document.getElementById('teamLogo').src = "https://via.placeholder.com/160?text=No+Player";
      }
    });
  </script>
</body>
</html>
